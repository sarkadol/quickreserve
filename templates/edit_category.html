{% extends 'main.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}

<div class="container-md">
    <h1> Edit category '{{ category_name }}' in offer '{{ offer_name }}' </h1>
    <form method="post" class="form">
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary">Save changes</button>
    </form>
    <a onclick="location.href='{% url 'delete_category' offer_id category_id %}'" class="btn btn-danger"
        id="addrow">Delete this category</a>

    <form method="get" action="" id="date-form">
        <input type="date" name="selected_date" required>
        <button type="submit">Show Availability</button>
    </form>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Unit / Time</th>
                {% for hour in hours %}
                <th>{{ hour|time:"H" }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>{% if units %}
            {% for unit in units %}
            <tr>
                <td>{{ unit.unit_name }}</td>
                {% for hour in hours %}
                <td>
                    {% with reservations=unit.reservation_slots.all %}
                    {% for slot in reservations %}
                    {% if slot.start_time <= hour and slot.end_time > hour %}
                        <div class="reserved-slot">Reserved</div>
                        {% else %}
                        <div class="available-slot">something</div>
                        {% endif %}
                        {% empty %}
                        <div class="available-slot">Available</div>
                        {% endfor %}
                        {% endwith %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
            {% else %}
            <td>There are no units yet</td>
            {% endif %}
        </tbody>
    </table>
</div>
<script src="{% static 'date_based_reservation.js' %}"></script>
{% endblock %}